<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout.html">
<div layout:fragment="content">
    <div class="card-like">
        <h3 th:if="${req.handled}" class="form-title detail-title-processed">Обработанная заявка</h3>
        <h3 th:unless="${req.handled}" class="form-title detail-title-new">Новая заявка</h3>
        <form class="request-view" th:object="${req}">
            <div class="form-group">
                <label class="form-label">ФИО :</label>
                <div class="form-input readonly" th:text="${req.userName}">Имя</div>
            </div>
            <div class="form-group">
                <label class="form-label">Курс :</label>
                <div class="form-input readonly">
                    <span th:if="${req.course != null}" th:text="${req.course.name + ' — ' + req.course.price + '₸'}">Курс</span>
                    <span th:unless="${req.course != null}">Не выбран</span>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Телефон :</label>
                <div class="form-input readonly" th:text="${req.phone}">Телефон</div>
            </div>
            <div class="form-group">
                <label class="form-label">Комментарии :</label>
                <div class="form-textarea readonly">
                    <div th:if="${#strings.isEmpty(req.commentary)}">Комментариев нет.</div>
                    <div th:unless="${#strings.isEmpty(req.commentary)}" th:text="${req.commentary}">Текст комментария</div>
                </div>
            </div>
        </form>
        <div class="actions-row">
            <a th:if="${!req.handled}" th:href="@{'/requests/' + ${req.id} + '/process'}" class="btn btn-primary">Обработать</a>
            <form th:action="@{'/requests/' + ${req.id} + '/delete'}" method="post" style="display:inline;">
                <button type="submit" class="btn btn-danger">Удалить</button>
            </form>
        </div>
        <div th:if="${!#lists.isEmpty(req.operators)}">
            <table class="operators-table" role="table">
                <thead>
                <tr>
                    <th class="col-delete">Удалить</th>
                    <th class="col-name">Имя</th>
                    <th class="col-surname">Фамилия</th>
                    <th class="col-dept">Департамент</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="op : ${req.operators}">
                    <td class="col-delete">
                        <form th:action="@{'/requests/' + ${req.id} + '/operators/' + ${op.id} + '/remove'}" method="post">
                            <button type="submit" class="btn-delete-x">✕</button>
                        </form>
                    </td>
                    <td th:text="${op.name}">Имя</td>
                    <td th:text="${op.surname}">Фамилия</td>
                    <td th:text="${op.department}">Департамент</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</html>
